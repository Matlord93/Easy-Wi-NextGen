name: Webinterface Release Bundle

on:
  push:
    tags: [ "v*.*.*" ]

permissions:
  contents: write

jobs:
  release:
    name: Build webinterface bundle
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Prepare bundle
        run: |
          VERSION="${GITHUB_REF_NAME}"
          mkdir -p dist
          tar -czf "dist/webinterface-${VERSION}.tar.gz" \
            --exclude=".git" \
            --exclude=".github" \
            --exclude="core/var/cache" \
            --exclude="core/var/log" \
            --exclude="core/.env.local" \
            --exclude="core/node_modules" \
            .
          zip -r "dist/webinterface-${VERSION}.zip" . \
            -x ".git/*" \
            -x ".github/*" \
            -x "core/var/cache/*" \
            -x "core/var/log/*" \
            -x "core/.env.local" \
            -x "core/node_modules/*"

      - name: Generate checksums
        run: |
          cd dist
          sha256sum webinterface-* > checksums-webinterface.txt

      - name: Upload to GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            dist/webinterface-*.tar.gz
            dist/webinterface-*.zip
            dist/checksums-webinterface.txt
          generate_release_notes: true
