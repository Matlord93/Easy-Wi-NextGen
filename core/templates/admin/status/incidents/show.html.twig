{% extends 'admin/base.html.twig' %}

{% block title %}Incident Updates Â· Easy-Wi NextGen{% endblock %}

{% block content %}
{% set statusStyles = {
    'investigating': 'bg-amber-100 text-amber-700',
    'identified': 'bg-indigo-100 text-indigo-700',
    'monitoring': 'bg-sky-100 text-sky-700',
    'resolved': 'bg-emerald-100 text-emerald-700'
} %}
<div class="space-y-6">
    {% include 'admin/status/_nav.html.twig' %}
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div>
            <a href="/admin/status/incidents" class="text-sm text-slate-500 hover:text-slate-700">&larr; Back to incidents</a>
            <h1 class="mt-2 text-2xl font-semibold">{{ incident.title }}</h1>
            {% if incident.message %}
                <p class="text-sm text-slate-500">{{ incident.message }}</p>
            {% endif %}
        </div>
        <div class="flex items-center gap-3">
            <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold {{ statusStyles[incident.status]|default('bg-slate-100 text-slate-600') }}">
                {{ incident.status|capitalize }}
            </span>
            <span class="inline-flex items-center rounded-full {{ incident.visible_public ? 'bg-indigo-50 text-indigo-700' : 'bg-slate-100 text-slate-600' }} px-3 py-1 text-xs font-semibold">
                {{ incident.visible_public ? 'Public' : 'Hidden' }}
            </span>
        </div>
    </div>

    <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
        <div class="rounded-xl border border-slate-200 bg-white">
            <div class="border-b border-slate-200 px-6 py-4">
                <h2 class="text-lg font-semibold">Timeline</h2>
            </div>
            <div id="incident-updates" hx-trigger="incident-updates-changed from:body" hx-get="/admin/status/incidents/{{ incident.id }}/updates" hx-swap="innerHTML">
                {% include 'admin/status/incidents/_updates.html.twig' with { updates: updates } %}
            </div>
        </div>
        <div class="rounded-xl border border-slate-200 bg-white" id="incident-update-form">
            {% include 'admin/status/incidents/_update_form.html.twig' with { updateForm: updateForm, statuses: statuses } %}
        </div>
    </div>
</div>
{% endblock %}
