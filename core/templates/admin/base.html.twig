<!DOCTYPE html>
{% set siteTitle = app_setting('site_title', 'Easy-Wi NextGen') %}
{% set brandingName = app_setting('branding_name', siteTitle) %}
{% set brandingLogo = app_setting('branding_logo_url') %}
<html lang="{{ pageLocale|default(page_locale()) }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        (function () {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    {% block title %}{% endblock %}
    <title></title>
    <link rel="stylesheet" href="{{ asset('ui.css') }}">
    <link rel="stylesheet" href="{{ asset('admin-customer.css') }}">
    <link rel="stylesheet" href="{{ asset('ts6.css') }}">
    <link rel="stylesheet" href="{{ asset('sinusbot.css') }}">
    <link rel="stylesheet" href="{{ asset('ts3.css') }}">
    <script src="{{ asset('htmx.min.js') }}"></script>
</head>
<body class="admin-interface ng-shell">
{% set activeNav = activeNav|default('') %}
{% set extensionItems = extension_menu_items('admin') %}
{% set marketplaceItems = extensionItems is not empty ? extensionItems : [] %}
{% set moduleGame = module_enabled('game') %}
{% set moduleTs = module_enabled('ts') %}
{% set moduleTs6 = module_enabled('ts6') %}
{% set moduleTsCombined = moduleTs or moduleTs6 %}
{% set moduleWeb = module_enabled('web') %}
{% set moduleMail = module_enabled('mail') %}
{% set moduleDns = module_enabled('dns') %}
{% set moduleBilling = module_enabled('billing') %}

{% set customerItems = [
    { key: 'users', label: t('admin_nav_users', page_locale()), href: path('admin_users') },
    moduleBilling ? { key: 'billing', label: t('admin_nav_billing', page_locale()), href: path('admin_billing') } : null
]|filter(v => v) %}

{% set infrastructureItems = [
    moduleGame ? { key: 'game-instances', label: 'Gameserver', href: path('admin_instances') } : null,
    moduleGame ? { key: 'sinusbot', label: 'SinusBot', href: path('admin_sinusbot_nodes_index') } : null,
    moduleTsCombined ? { key: 'ts-nodes', label: 'TeamSpeak Nodes', href: path('admin_ts_nodes_index') } : null,
    moduleTs ? { key: 'ts3-servers', label: 'TeamSpeak 3 Server', href: path('admin_ts3_servers_index') } : null,
    moduleTs6 ? { key: 'ts6-servers', label: 'TeamSpeak 6 Server', href: path('admin_ts6_servers_index') } : null,
    { key: 'nodes', label: t('admin_nav_nodes', page_locale()), href: path('admin_nodes') },
    moduleGame ? { key: 'templates', label: t('admin_nav_templates', page_locale()), href: path('admin_templates') } : null,
    moduleGame ? { key: 'plugins', label: t('admin_nav_plugins', page_locale()), href: path('admin_plugins') } : null,
    { key: 'ddos', label: t('admin_nav_ddos_policy', page_locale()), href: path('admin_ddos') },
    { key: 'firewall', label: t('admin_nav_security', page_locale()), href: path('admin_security') },
    { key: 'port-blocks', label: t('admin_nav_port_blocks', page_locale()), href: path('admin_port_blocks') },
    { key: 'metrics', label: t('admin_nav_metrics', page_locale()), href: path('admin_metrics') }
]|filter(v => v) %}

{% set servicesItems = [
    moduleWeb ? { key: 'webspaces', label: t('admin_nav_webspaces', page_locale()), href: path('admin_webspaces') } : null,
    { key: 'databases', label: t('admin_nav_databases', page_locale()), href: path('admin_databases') }
]|filter(v => v) %}

{% set shopItems = moduleBilling ? [
    { key: 'shop-categories', label: 'Shop-Kategorien', href: path('admin_shop_categories') },
    { key: 'shop-products', label: 'Shop-Produkte', href: path('admin_shop_products') }
] : [] %}

{% set cmsItems = [
    { key: 'cms-pages', label: t('cms_pages_title', page_locale()), href: path('admin_cms_pages') },
    { key: 'public-servers', label: t('admin_nav_cms_gameservers', page_locale()), href: path('admin_public_servers') }
] %}

{% set domainItems = [
    moduleDns ? { key: 'dns-records', label: t('admin_nav_dns_records', page_locale()), href: path('admin_dns_records') } : null,
    moduleMail ? { key: 'mailboxes', label: t('admin_nav_mailboxes', page_locale()), href: path('admin_mailboxes') } : null,
    moduleMail ? { key: 'mail-aliases', label: t('admin_nav_mail_aliases', page_locale()), href: path('admin_mail_aliases') } : null
]|filter(v => v) %}

{% set sidebarGroups = [
    {
        label: 'Ãœbersicht',
        open: true,
        items: [
            { key: 'dashboard', label: t('admin_nav_dashboard', page_locale()), href: path('admin_dashboard') },
            { key: 'activity', label: t('activity', page_locale()), href: path('admin_activity') },
            { key: 'audit-logs', label: t('admin_nav_audit_logs', page_locale()), href: path('admin_audit_logs') }
        ]
    },
    customerItems is not empty ? {
        label: 'Kunden',
        open: true,
        items: customerItems
    } : null,
    infrastructureItems is not empty ? {
        label: 'Infrastruktur',
        open: true,
        items: infrastructureItems
    } : null,
    servicesItems is not empty ? {
        label: 'Services',
        open: true,
        items: servicesItems
    } : null,
    shopItems is not empty ? {
        label: 'Shop',
        open: true,
        items: shopItems
    } : null,
    cmsItems is not empty ? {
        label: 'CMS System',
        open: true,
        items: cmsItems
    } : null,
    domainItems is not empty ? {
        label: 'Domains & E-Mail',
        open: true,
        items: domainItems
    } : null,
    {
        label: 'Support',
        open: true,
        items: [
            { key: 'tickets', label: t('admin_nav_tickets', page_locale()), href: path('admin_tickets') }
        ]
    },
    marketplaceItems is not empty ? {
        label: 'Marketplace',
        open: false,
        items: marketplaceItems
    } : null,
    {
        label: 'Einstellungen',
        open: true,
        items: [
            { key: 'settings', label: t('admin_nav_settings', page_locale()), href: path('admin_settings') },
            { key: 'modules', label: t('admin_nav_modules', page_locale()), href: path('admin_modules') },
            { key: 'port-pools', label: t('admin_nav_port_pools', page_locale()), href: path('admin_port_pools') },
            { key: 'bootstrap-tokens', label: t('admin_nav_bootstrap_tokens', page_locale()), href: path('admin_agent_bootstrap_tokens') },
            { key: 'profile', label: t('admin_nav_profile', page_locale()), href: path('admin_profile') },
            { key: 'updates', label: t('admin_updates_title', page_locale()), href: path('admin_updates') }
        ]
    }
]|filter(v => v) %}

<div class="ng-layout">
    {% include 'components/_sidebar.html.twig' with {
        title: '',
        logoUrl: null,
        activeNav: activeNav,
        groups: sidebarGroups,
        footer: ''
    } %}

    <main class="ng-main">
        {% include 'components/_topbar.html.twig' with {
            title: pageTitle|default(''),
            subtitle: pageSubtitle|default(''),
            actions: topbarActions|default([])
        } %}
        <div class="ng-content">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>
<script>
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
    }
</script>
</body>
</html>
