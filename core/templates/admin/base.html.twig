<!DOCTYPE html>
<html lang="{{ pageLocale|default(page_locale()) }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        (function () {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <title>{% block title %}Easy-Wi NextGen{% endblock %}</title>
    <link rel="stylesheet" href="/ui.css">
    <link rel="stylesheet" href="/admin-customer.css">
    <link rel="stylesheet" href="/ts6.css">
    <link rel="stylesheet" href="/sinusbot.css">
    <link rel="stylesheet" href="/ts3.css">
    <script src="/htmx.min.js"></script>
</head>
<body class="admin-interface ng-shell">
{% set activeNav = activeNav|default('') %}
{% set extensionItems = extension_menu_items('admin') %}
{% set marketplaceItems = extensionItems is not empty ? extensionItems : [] %}

{% set sidebarGroups = [
    {
        label: 'Ãœbersicht',
        open: true,
        items: [
            { key: 'dashboard', label: t('admin_nav_dashboard', page_locale()), href: '/admin' },
            { key: 'activity', label: t('activity', page_locale()), href: '/admin/activity' },
            { key: 'audit-logs', label: t('admin_nav_audit_logs', page_locale()), href: '/admin/audit-logs' }
        ]
    },
    {
        label: 'Kunden',
        open: true,
        items: [
            { key: 'users', label: t('admin_nav_users', page_locale()), href: '/admin/users' },
            { key: 'billing', label: t('admin_nav_billing', page_locale()), href: '/admin/billing' }
        ]
    },
    {
        label: 'Infrastruktur',
        open: true,
        items: [
            { key: 'game-instances', label: 'Gameserver', href: '/admin/instances' },
            { key: 'public-servers', label: 'CMS Game-Server', href: '/admin/servers' },
            { key: 'sinusbot', label: 'SinusBot', href: '/admin/sinusbot/nodes' },
            { key: 'ts3', label: 'TeamSpeak 3', href: '/admin/ts3/nodes' },
            { key: 'ts6', label: 'TeamSpeak 6', href: '/admin/ts6/nodes' },
            { key: 'nodes', label: t('admin_nav_nodes', page_locale()), href: '/admin/nodes' },
            { key: 'templates', label: t('admin_nav_templates', page_locale()), href: '/admin/templates' },
            { key: 'plugins', label: t('admin_nav_plugins', page_locale()), href: '/admin/plugins' },
            { key: 'ddos', label: t('admin_nav_ddos_policy', page_locale()), href: '/admin/ddos' },
            { key: 'firewall', label: t('admin_nav_security', page_locale()), href: '/admin/security' },
            { key: 'port-blocks', label: t('admin_nav_port_blocks', page_locale()), href: '/admin/port-blocks' },
            { key: 'metrics', label: t('admin_nav_metrics', page_locale()), href: '/admin/metrics' }
        ]
    },
    {
        label: 'Services',
        open: true,
        items: [
            { key: 'webspaces', label: 'Webspace', href: '/admin/webspaces' },
            { key: 'databases', label: 'Datenbanken', href: '/admin/databases' }
        ]
    },
    {
        label: 'Domains & E-Mail',
        open: true,
        items: [
            { key: 'mailboxes', label: 'Mailboxes', href: '/admin/mailboxes' },
            { key: 'mail-aliases', label: 'Mail-Aliase', href: '/admin/mail-aliases' }
        ]
    },
    {
        label: 'Support',
        open: true,
        items: [
            { key: 'tickets', label: t('admin_nav_tickets', page_locale()), href: '/admin/tickets' }
        ]
    },
    marketplaceItems is not empty ? {
        label: 'Marketplace',
        open: false,
        items: marketplaceItems
    } : null,
    {
        label: 'Einstellungen',
        open: true,
        items: [
            { key: 'settings', label: t('admin_nav_settings', page_locale()), href: '/admin/settings' },
            { key: 'modules', label: t('admin_nav_modules', page_locale()), href: '/admin/modules' },
            { key: 'port-pools', label: t('admin_nav_port_pools', page_locale()), href: '/admin/port-pools' },
            { key: 'bootstrap-tokens', label: t('admin_nav_bootstrap_tokens', page_locale()), href: '/admin/agent-bootstrap-tokens' },
            { key: 'profile', label: t('admin_nav_profile', page_locale()), href: '/admin/profile' },
            { key: 'updates', label: t('admin_updates_title', page_locale()), href: '/admin/updates' }
        ]
    }
]|filter(v => v) %}

<div class="ng-layout">
    {% include 'components/_sidebar.html.twig' with {
        title: 'Easy-Wi NextGen',
        activeNav: activeNav,
        groups: sidebarGroups,
        footer: t('admin_portal_tagline', page_locale())
    } %}

    <main class="ng-main">
        {% include 'components/_topbar.html.twig' with {
            title: pageTitle|default(''),
            subtitle: pageSubtitle|default(''),
            actions: topbarActions|default([])
        } %}
        <div class="ng-content">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>
<script>
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
    }
</script>
</body>
</html>
