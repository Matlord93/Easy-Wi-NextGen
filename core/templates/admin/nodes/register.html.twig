{% extends 'admin/base.html.twig' %}


{% block content %}
<div class="flex items-center justify-between mb-6">
    <div>
        <h1 class="text-2xl font-semibold">{{ t('admin_nodes_register_title', page_locale()) }}</h1>
        <p class="text-sm text-slate-700">{{ t('admin_nodes_register_intro', page_locale()) }}</p>
    </div>
    <a href="/admin/nodes" class="rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700">{{ t('admin_nodes_back', page_locale()) }}</a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="rounded-xl border border-slate-200 bg-white p-6">
        <h2 class="text-lg font-semibold text-slate-900">{{ t('admin_nodes_agent_details', page_locale()) }}</h2>
        <p class="mt-1 text-sm text-slate-700">{{ t('admin_nodes_agent_details_intro', page_locale()) }}</p>

        {% if form.errors is not empty %}
            <div class="mt-4 rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
                <ul class="list-disc pl-5">
                    {% for error in form.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <form method="post" class="mt-4 space-y-4">
            <div>
                <label class="text-sm font-medium text-slate-700" for="agent_id">{{ t('admin_nodes_agent_id', page_locale()) }}</label>
                <input
                    id="agent_id"
                    name="agent_id"
                    type="text"
                    value="{{ form.agent_id }}"
                    placeholder="node-eu-01"
                    class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm"
                >
                <p class="mt-1 text-xs text-slate-700">{{ t('admin_nodes_agent_id_hint', page_locale()) }}</p>
            </div>
            <div>
                <label class="text-sm font-medium text-slate-700" for="name">{{ t('admin_nodes_display_name', page_locale()) }}</label>
                <input
                    id="name"
                    name="name"
                    type="text"
                    value="{{ form.name }}"
                    placeholder="Web Node Frankfurt"
                    class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm"
                >
            </div>
            <button class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-slate-900 text-white">{{ t('admin_nodes_create_agent', page_locale()) }}</button>
        </form>
    </div>

    <div class="rounded-xl border border-slate-200 bg-white p-6">
        <h2 class="text-lg font-semibold text-slate-900">{{ t('admin_nodes_agent_config', page_locale()) }}</h2>
        <p class="mt-1 text-sm text-slate-700">{{ t('admin_nodes_agent_config_intro', page_locale()) }}</p>

        {% if config %}
            <div class="mt-4 rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
                {{ t('admin_nodes_agent_registered', page_locale())|replace({'%id%': config.agent_id}) }}
            </div>
            <div class="mt-4">
                <p class="text-xs font-semibold uppercase text-slate-700">/etc/easywi/agent.conf</p>
                <pre class="mt-2 whitespace-pre-wrap rounded-lg border border-slate-200 bg-slate-900 px-4 py-3 text-xs text-slate-100">
agent_id={{ config.agent_id }}
secret={{ config.secret }}
api_url={{ config.api_url }}
heartbeat_interval=60s
poll_interval=30s
</pre>
            </div>
            <div class="mt-4 text-sm text-slate-600">
                <p class="font-semibold text-slate-700">{{ t('admin_nodes_start_agent', page_locale()) }}</p>
                <pre class="mt-2 whitespace-pre-wrap rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 text-xs text-slate-600">./easywi-agent -config /etc/easywi/agent.conf</pre>
            </div>
        {% else %}
            <div class="mt-4 rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
                {{ t('admin_nodes_config_pending', page_locale()) }}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
