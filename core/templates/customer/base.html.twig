<!DOCTYPE html>
<html lang="{{ pageLocale|default(page_locale()) }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Easy-Wi NextGen{% endblock %}</title>
    <script>
        tailwind = {
            config: {
                darkMode: 'class',
            },
        };
    </script>
    <script>
        (function () {
            const stored = localStorage.getItem('theme');
            if (stored === 'dark') {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
{% set activeNav = activeNav|default('') %}
<input id="sidebar-toggle" type="checkbox" class="peer sr-only">
<div class="min-h-screen flex">
    <div class="fixed inset-0 z-30 hidden bg-slate-900/40 peer-checked:block lg:hidden"></div>
    <aside class="fixed inset-y-0 left-0 z-40 w-64 -translate-x-full bg-slate-950 text-white transition-transform peer-checked:translate-x-0 lg:translate-x-0 lg:static lg:flex lg:flex-col">
        <div class="px-6 py-5 text-lg font-semibold tracking-tight">Easy-Wi NextGen</div>
        <nav class="flex-1 px-4 space-y-2">
            <a href="/profile" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'profile' ? 'bg-slate-800 text-white' : 'text-slate-300 transition hover:bg-slate-800 hover:text-white' }}">
                <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'profile' ? 'bg-slate-700' : 'bg-slate-900' }}">
                    <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10 11.5a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-6 6.5a6 6 0 0 1 12 0Z"/>
                    </svg>
                </span>
                <span class="text-sm font-medium">Profile &amp; Billing</span>
            </a>
            <a href="/tickets" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'tickets' ? 'bg-slate-800 text-white' : 'text-slate-300 transition hover:bg-slate-800 hover:text-white' }}">
                <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'tickets' ? 'bg-slate-700' : 'bg-slate-900' }}">
                    <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M4 4.75A.75.75 0 0 1 4.75 4h10.5a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-.75.75H4.75A.75.75 0 0 1 4 7.25v-2.5Zm0 8a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-.75.75H4.75a.75.75 0 0 1-.75-.75v-2.5Z"/>
                    </svg>
                </span>
                <span class="text-sm font-medium">Tickets</span>
            </a>
            <a href="/instances" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'instances' ? 'bg-slate-800 text-white' : 'text-slate-300 transition hover:bg-slate-800 hover:text-white' }}">
                <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'instances' ? 'bg-slate-700' : 'bg-slate-900' }}">
                    <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M4 3.5A1.5 1.5 0 0 1 5.5 2h9A1.5 1.5 0 0 1 16 3.5v13a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 4 16.5v-13Zm4 3.5a1 1 0 0 0 0 2h4a1 1 0 0 0 0-2H8Zm0 4a1 1 0 0 0 0 2h4a1 1 0 0 0 0-2H8Z"/>
                    </svg>
                </span>
                <span class="text-sm font-medium">Instances</span>
            </a>
            <a href="/files" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'files' ? 'bg-slate-800 text-white' : 'text-slate-300 transition hover:bg-slate-800 hover:text-white' }}">
                <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'files' ? 'bg-slate-700' : 'bg-slate-900' }}">
                    <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M2 5.25A2.25 2.25 0 0 1 4.25 3h4.62a2.25 2.25 0 0 1 1.59.66l1.88 1.87c.42.42.66.99.66 1.59v7.63A2.25 2.25 0 0 1 10.75 17h-6.5A2.25 2.25 0 0 1 2 14.75v-9.5ZM4.25 4.5a.75.75 0 0 0-.75.75v9.5c0 .41.34.75.75.75h6.5a.75.75 0 0 0 .75-.75V7.12a.75.75 0 0 0-.22-.53L9.4 4.72a.75.75 0 0 0-.53-.22H4.25Z"/>
                    </svg>
                </span>
                <span class="text-sm font-medium">File Manager</span>
            </a>
            {% set extensionItems = extension_menu_items('customer') %}
            {% for item in extensionItems %}
                <a href="{{ item.href }}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-slate-300 transition hover:bg-slate-800 hover:text-white">
                    <span class="flex h-8 w-8 items-center justify-center rounded-md bg-slate-900">
                        {% if item.iconSvg %}
                            {{ item.iconSvg|raw }}
                        {% else %}
                            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10 3.5a2.5 2.5 0 0 1 2.45 2h1.8a1.75 1.75 0 0 1 1.75 1.75v1.5a1.75 1.75 0 0 1-1.75 1.75h-1.8a2.5 2.5 0 0 1-4.9 0h-1.8A1.75 1.75 0 0 1 4 10.75v-1.5A1.75 1.75 0 0 1 5.75 7.5h1.8A2.5 2.5 0 0 1 10 3.5Zm0 1.5a1 1 0 0 0-1 1v1.25H5.75a.25.25 0 0 0-.25.25v1.5c0 .14.11.25.25.25H9V11a1 1 0 1 0 2 0V9.75h3.25a.25.25 0 0 0 .25-.25v-1.5a.25.25 0 0 0-.25-.25H11V6a1 1 0 0 0-1-1Z"/>
                            </svg>
                        {% endif %}
                    </span>
                    <span class="text-sm font-medium">{{ item.label }}</span>
                </a>
            {% endfor %}
            <a href="/activity" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'activity' ? 'bg-slate-800 text-white' : 'text-slate-300 transition hover:bg-slate-800 hover:text-white' }}">
                <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'activity' ? 'bg-slate-700' : 'bg-slate-900' }}">
                    <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10 3.5a.75.75 0 0 1 .75.75v5.44l3.22 1.86a.75.75 0 1 1-.75 1.3l-3.6-2.08a.75.75 0 0 1-.37-.65V4.25A.75.75 0 0 1 10 3.5Zm0 13A6.5 6.5 0 1 0 3.5 10a6.5 6.5 0 0 0 6.5 6.5Zm0 1.5A8 8 0 1 1 18 10a8 8 0 0 1-8 8Z"/>
                    </svg>
                </span>
                <span class="text-sm font-medium">{{ t('activity', page_locale()) }}</span>
            </a>
        </nav>
        <div class="px-6 py-4 text-xs text-slate-400">Customer Portal Â· vNext</div>
    </aside>

    <main class="flex-1 flex flex-col lg:ml-0">
        <header class="sticky top-0 z-20 bg-white/95 backdrop-blur border-b border-slate-200">
            <div class="flex items-center justify-between px-4 py-4 sm:px-6">
                <div class="flex items-center gap-3 w-full">
                    <label for="sidebar-toggle" class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-200 text-slate-500 lg:hidden">
                        <span class="sr-only">Toggle sidebar</span>
                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M3 5.75A.75.75 0 0 1 3.75 5h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 5.75Zm0 4A.75.75 0 0 1 3.75 9h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 9.75Zm0 4a.75.75 0 0 1 .75-.75h12.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z"/>
                        </svg>
                    </label>
                    <div class="relative w-full max-w-xl">
                        <input
                            id="global-search-input"
                            type="search"
                            placeholder="Search tickets"
                            aria-label="Search tickets"
                            class="w-full rounded-lg border border-slate-200 bg-slate-50 px-4 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"
                        >
                        <div class="mt-1 text-xs text-slate-400">{{ t('search_help', page_locale()) }}</div>
                    </div>
                </div>
                <div class="hidden items-center gap-4 sm:flex">
                    <button
                        id="theme-toggle"
                        class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 dark:border-slate-700 dark:text-slate-200"
                        aria-label="{{ t('toggle_theme', page_locale()) }}"
                    >{{ t('toggle_theme', page_locale()) }}</button>
                    <a
                        href="/notifications"
                        class="relative rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 dark:border-slate-700 dark:text-slate-200"
                        aria-label="{{ t('notifications', page_locale()) }}"
                    >
                        {{ t('notifications', page_locale()) }}
                        {% set notificationCount = unread_notifications() %}
                        {% if notificationCount > 0 %}
                            <span class="absolute -right-2 -top-2 inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-rose-500 px-1 text-[10px] font-semibold text-white">{{ notificationCount }}</span>
                        {% endif %}
                    </a>
                    <button class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 dark:border-slate-700 dark:text-slate-200">New Ticket</button>
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                            <p class="text-sm font-semibold">Customer</p>
                            <p class="text-xs text-slate-500">Support Portal</p>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-semibold">C</div>
                    </div>
                </div>
                <div class="flex items-center gap-3 sm:hidden">
                    <div class="h-9 w-9 rounded-full bg-indigo-500 text-white flex items-center justify-center text-sm font-semibold">C</div>
                </div>
            </div>
        </header>

        <section class="px-4 py-6 sm:px-6">
            {% block content %}{% endblock %}
        </section>
    </main>
</div>
<script>
    document.addEventListener('keydown', (event) => {
        if (event.key === '/' && document.activeElement?.tagName !== 'INPUT') {
            const search = document.getElementById('global-search-input');
            if (search) {
                event.preventDefault();
                search.focus();
            }
        }
    });

    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
    }
</script>
</body>
</html>
