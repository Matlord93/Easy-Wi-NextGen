<!DOCTYPE html>
<html lang="{{ pageLocale|default(page_locale()) }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        (function () {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <title>{% block title %}Easy-Wi NextGen{% endblock %}</title>
    <link rel="stylesheet" href="/ui.css">
    <link rel="stylesheet" href="/admin-customer.css">
    <script src="/htmx.min.js"></script>
</head>
<body class="customer-interface bg-slate-100 text-slate-900">
{% set activeNav = activeNav|default('') %}
<input id="sidebar-toggle" type="checkbox" class="peer sr-only">
<div class="min-h-screen flex">
    <label for="sidebar-toggle" class="fixed inset-0 z-30 hidden bg-slate-900/40 peer-checked:block lg:hidden" aria-label="{{ t('customer_toggle_sidebar', page_locale()) }}"></label>
    <aside class="fixed inset-y-0 left-0 z-40 w-64 -translate-x-full bg-gradient-to-b from-indigo-700 via-slate-900 to-slate-950 text-slate-100 shadow-xl transition-transform peer-checked:translate-x-0 lg:translate-x-0 lg:static lg:flex lg:flex-col">
        <div class="px-6 py-5 text-lg font-semibold tracking-tight">Easy-Wi NextGen</div>
        <nav class="flex-1 px-4 space-y-4">
            <details class="nav-group group" data-nav-id="customer-account" open>
                <summary class="flex items-center justify-between rounded-lg px-3 py-2 text-xs font-semibold uppercase tracking-wide text-indigo-100/80 hover:text-white">
                    <span>Account</span>
                    <svg class="h-4 w-4 transition group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 11.17l3.71-3.94a.75.75 0 1 1 1.08 1.04l-4.25 4.5a.75.75 0 0 1-1.08 0l-4.25-4.5a.75.75 0 0 1 .02-1.06Z"/>
                    </svg>
                </summary>
                <div class="mt-2 space-y-1">
                    <a href="/dashboard" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'dashboard' ? 'bg-white/10 text-white shadow-inner ring-1 ring-white/10' : 'text-indigo-100/80 transition hover:bg-white/10 hover:text-white' }}">
                        <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'dashboard' ? 'bg-white/15' : 'bg-white/10' }}">
                            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M3 10.5a1.5 1.5 0 0 1 1.5-1.5h3a1.5 1.5 0 0 1 1.5 1.5v4A1.5 1.5 0 0 1 7.5 16h-3A1.5 1.5 0 0 1 3 14.5v-4Zm8-5A1.5 1.5 0 0 1 12.5 4h3A1.5 1.5 0 0 1 17 5.5v9a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 11 14.5v-9Zm-8-1A1.5 1.5 0 0 1 4.5 3h3A1.5 1.5 0 0 1 9 4.5v2A1.5 1.5 0 0 1 7.5 8h-3A1.5 1.5 0 0 1 3 6.5v-2Zm8 4A1.5 1.5 0 0 1 12.5 7h3A1.5 1.5 0 0 1 17 8.5v2a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 11 10.5v-2Z"/>
                            </svg>
                        </span>
                        <span class="text-sm font-medium">{{ t('dashboard', page_locale()) }}</span>
                    </a>
                    <a href="/profile" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'profile' ? 'bg-white/10 text-white shadow-inner ring-1 ring-white/10' : 'text-indigo-100/80 transition hover:bg-white/10 hover:text-white' }}">
                        <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'profile' ? 'bg-white/15' : 'bg-white/10' }}">
                            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10 11.5a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-6 6.5a6 6 0 0 1 12 0Z"/>
                            </svg>
                        </span>
                        <span class="text-sm font-medium">{{ t('customer_nav_profile_billing', page_locale()) }}</span>
                    </a>
                    <a href="/activity" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'activity' ? 'bg-white/10 text-white shadow-inner ring-1 ring-white/10' : 'text-indigo-100/80 transition hover:bg-white/10 hover:text-white' }}">
                        <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'activity' ? 'bg-white/15' : 'bg-white/10' }}">
                            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10 3.5a.75.75 0 0 1 .75.75v5.44l3.22 1.86a.75.75 0 1 1-.75 1.3l-3.6-2.08a.75.75 0 0 1-.37-.65V4.25A.75.75 0 0 1 10 3.5Zm0 13A6.5 6.5 0 1 0 3.5 10a6.5 6.5 0 0 0 6.5 6.5Zm0 1.5A8 8 0 1 1 18 10a8 8 0 0 1-8 8Z"/>
                            </svg>
                        </span>
                        <span class="text-sm font-medium">{{ t('activity', page_locale()) }}</span>
                    </a>
                </div>
            </details>

            <details class="nav-group group" data-nav-id="customer-services" open>
                <summary class="flex items-center justify-between rounded-lg px-3 py-2 text-xs font-semibold uppercase tracking-wide text-indigo-100/80 hover:text-white">
                    <span>Services</span>
                    <svg class="h-4 w-4 transition group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 11.17l3.71-3.94a.75.75 0 1 1 1.08 1.04l-4.25 4.5a.75.75 0 0 1-1.08 0l-4.25-4.5a.75.75 0 0 1 .02-1.06Z"/>
                    </svg>
                </summary>
                <div class="mt-2 space-y-1">
                    <a href="/instances" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'instances' ? 'bg-white/10 text-white shadow-inner ring-1 ring-white/10' : 'text-indigo-100/80 transition hover:bg-white/10 hover:text-white' }}">
                        <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'instances' ? 'bg-white/15' : 'bg-white/10' }}">
                            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M4 3.5A1.5 1.5 0 0 1 5.5 2h9A1.5 1.5 0 0 1 16 3.5v13a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 4 16.5v-13Zm4 3.5a1 1 0 0 0 0 2h4a1 1 0 0 0 0-2H8Zm0 4a1 1 0 0 0 0 2h4a1 1 0 0 0 0-2H8Z"/>
                            </svg>
                        </span>
                        <span class="text-sm font-medium">{{ t('customer_nav_instances', page_locale()) }}</span>
                    </a>
                    <a href="/files" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'files' ? 'bg-white/10 text-white shadow-inner ring-1 ring-white/10' : 'text-indigo-100/80 transition hover:bg-white/10 hover:text-white' }}">
                        <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'files' ? 'bg-white/15' : 'bg-white/10' }}">
                            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M2 5.25A2.25 2.25 0 0 1 4.25 3h4.62a2.25 2.25 0 0 1 1.59.66l1.88 1.87c.42.42.66.99.66 1.59v7.63A2.25 2.25 0 0 1 10.75 17h-6.5A2.25 2.25 0 0 1 2 14.75v-9.5ZM4.25 4.5a.75.75 0 0 0-.75.75v9.5c0 .41.34.75.75.75h6.5a.75.75 0 0 0 .75-.75V7.12a.75.75 0 0 0-.22-.53L9.4 4.72a.75.75 0 0 0-.53-.22H4.25Z"/>
                            </svg>
                        </span>
                        <span class="text-sm font-medium">{{ t('customer_nav_file_manager', page_locale()) }}</span>
                    </a>
                </div>
            </details>

            <details class="nav-group group" data-nav-id="customer-support" open>
                <summary class="flex items-center justify-between rounded-lg px-3 py-2 text-xs font-semibold uppercase tracking-wide text-indigo-100/80 hover:text-white">
                    <span>Support</span>
                    <svg class="h-4 w-4 transition group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 11.17l3.71-3.94a.75.75 0 1 1 1.08 1.04l-4.25 4.5a.75.75 0 0 1-1.08 0l-4.25-4.5a.75.75 0 0 1 .02-1.06Z"/>
                    </svg>
                </summary>
                <div class="mt-2 space-y-1">
                    <a href="/tickets" class="flex items-center gap-3 rounded-lg px-3 py-2 {{ activeNav == 'tickets' ? 'bg-white/10 text-white shadow-inner ring-1 ring-white/10' : 'text-indigo-100/80 transition hover:bg-white/10 hover:text-white' }}">
                        <span class="flex h-8 w-8 items-center justify-center rounded-md {{ activeNav == 'tickets' ? 'bg-white/15' : 'bg-white/10' }}">
                            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M4 4.75A.75.75 0 0 1 4.75 4h10.5a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-.75.75H4.75A.75.75 0 0 1 4 7.25v-2.5Zm0 8a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-.75.75H4.75a.75.75 0 0 1-.75-.75v-2.5Z"/>
                            </svg>
                        </span>
                        <span class="text-sm font-medium">{{ t('customer_nav_tickets', page_locale()) }}</span>
                    </a>
                </div>
            </details>

            {% set extensionItems = extension_menu_items('customer') %}
            {% if extensionItems is not empty %}
                <details class="nav-group group" data-nav-id="customer-extensions">
                    <summary class="flex items-center justify-between rounded-lg px-3 py-2 text-xs font-semibold uppercase tracking-wide text-indigo-100/80 hover:text-white">
                        <span>Extensions</span>
                        <svg class="h-4 w-4 transition group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 11.17l3.71-3.94a.75.75 0 1 1 1.08 1.04l-4.25 4.5a.75.75 0 0 1-1.08 0l-4.25-4.5a.75.75 0 0 1 .02-1.06Z"/>
                        </svg>
                    </summary>
                    <div class="mt-2 space-y-1">
                        {% for item in extensionItems %}
                            <a href="{{ item.href }}" class="flex items-center gap-3 rounded-lg px-3 py-2 text-indigo-100/80 transition hover:bg-white/10 hover:text-white">
                                <span class="flex h-8 w-8 items-center justify-center rounded-md bg-white/10">
                                    {% if item.iconSvg %}
                                        {{ item.iconSvg|raw }}
                                    {% else %}
                                        <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path d="M10 3.5a2.5 2.5 0 0 1 2.45 2h1.8a1.75 1.75 0 0 1 1.75 1.75v1.5a1.75 1.75 0 0 1-1.75 1.75h-1.8a2.5 2.5 0 0 1-4.9 0h-1.8A1.75 1.75 0 0 1 4 10.75v-1.5A1.75 1.75 0 0 1 5.75 7.5h1.8A2.5 2.5 0 0 1 10 3.5Zm0 1.5a1 1 0 0 0-1 1v1.25H5.75a.25.25 0 0 0-.25.25v1.5c0 .14.11.25.25.25H9V11a1 1 0 1 0 2 0V9.75h3.25a.25.25 0 0 0 .25-.25v-1.5a.25.25 0 0 0-.25-.25H11V6a1 1 0 0 0-1-1Z"/>
                                        </svg>
                                    {% endif %}
                                </span>
                                <span class="text-sm font-medium">{{ item.label }}</span>
                            </a>
                        {% endfor %}
                    </div>
                </details>
            {% endif %}
        </nav>
        <div class="px-6 py-4 text-xs text-slate-600/70">{{ t('customer_portal_tagline', page_locale()) }}</div>
    </aside>

    <main class="portal-main flex-1 flex flex-col lg:ml-0">
        <header class="sticky top-0 z-20 bg-slate-800/95 text-white backdrop-blur border-b border-slate-700 shadow-sm">
            <div class="flex items-center justify-between px-4 py-4 sm:px-6">
                <div class="flex items-center gap-3 w-full">
                    <label for="sidebar-toggle" class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-600 bg-slate-700/50 text-slate-200 transition hover:bg-slate-700 lg:hidden">
                        <span class="sr-only">{{ t('customer_toggle_sidebar', page_locale()) }}</span>
                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M3 5.75A.75.75 0 0 1 3.75 5h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 5.75Zm0 4A.75.75 0 0 1 3.75 9h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 9.75Zm0 4a.75.75 0 0 1 .75-.75h12.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z"/>
                        </svg>
                    </label>
                    <div class="relative w-full max-w-xl">
                        <input
                            id="global-search-input"
                            type="search"
                            placeholder="Search tickets"
                            aria-label="Search tickets"
                            class="w-full rounded-lg border border-slate-600 bg-slate-700 px-4 py-2 text-sm text-white placeholder-slate-300 focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-300/40"
                        >
                        <div class="mt-1 text-xs text-slate-600">{{ t('search_help', page_locale()) }}</div>
                    </div>
                </div>
                <div class="hidden items-center gap-4 sm:flex">
                    <button
                        id="theme-toggle"
                        class="rounded-lg border border-slate-600 bg-slate-700/50 px-3 py-2 text-xs font-medium text-slate-100 transition hover:bg-slate-700"
                        aria-label="{{ t('toggle_theme', page_locale()) }}"
                    >{{ t('toggle_theme', page_locale()) }}</button>
                    <a
                        href="/notifications"
                        class="btn relative rounded-lg border border-slate-600 bg-slate-700/50 px-3 py-2 text-xs font-medium text-slate-100 transition hover:bg-slate-700"
                        aria-label="{{ t('notifications', page_locale()) }}"
                    >
                        {{ t('notifications', page_locale()) }}
                        {% set notificationCount = unread_notifications() %}
                        {% include 'customer/notifications/_badge.html.twig' with { count: notificationCount, oob: false } %}
                    </a>
                    <button class="rounded-lg border border-slate-600 bg-slate-700/50 px-3 py-2 text-xs font-medium text-slate-100 transition hover:bg-slate-700">{{ t('customer_new_ticket', page_locale()) }}</button>
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                            <p class="text-sm font-semibold text-slate-900">{{ t('customer_user_label', page_locale()) }}</p>
                            <p class="text-xs text-slate-600">{{ t('customer_user_role', page_locale()) }}</p>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-semibold">C</div>
                    </div>
                </div>
                <div class="flex items-center gap-3 sm:hidden">
                    <div class="h-9 w-9 rounded-full bg-indigo-500 text-white flex items-center justify-center text-sm font-semibold text-slate-900">C</div>
                </div>
            </div>
        </header>

        <section class="mx-auto w-full max-w-6xl px-4 py-6 sm:px-6">
            {% block content %}{% endblock %}
        </section>
    </main>
</div>
<script>
    const navGroups = document.querySelectorAll('details[data-nav-id]');
    navGroups.forEach((group) => {
        const key = `nav-group:${group.dataset.navId}`;
        const stored = localStorage.getItem(key);
        if (stored !== null) {
            group.open = stored === 'open';
        }
        group.addEventListener('toggle', () => {
            localStorage.setItem(key, group.open ? 'open' : 'closed');
        });
    });

    document.addEventListener('keydown', (event) => {
        if (event.key === '/' && document.activeElement?.tagName !== 'INPUT') {
            const search = document.getElementById('global-search-input');
            if (search) {
                event.preventDefault();
                search.focus();
            }
        }
    });

    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
    }
</script>
</body>
</html>
