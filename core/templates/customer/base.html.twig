<!DOCTYPE html>
<html lang="{{ pageLocale|default(page_locale()) }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        (function () {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <title>{% block title %}Easy-Wi NextGen{% endblock %}</title>
    <link rel="stylesheet" href="/ui.css">
    <link rel="stylesheet" href="/admin-customer.css">
    <link rel="stylesheet" href="/ts6.css">
    <link rel="stylesheet" href="/ts3.css">
    <script src="/htmx.min.js"></script>
</head>
<body class="customer-interface ng-shell">
{% set activeNav = activeNav|default('') %}
{% set voiceserverUrl = module_enabled('ts6') ? '/customer/ts6/servers' : '/customer/ts3/servers' %}
{% set showVoiceserver = module_enabled('ts6') or module_enabled('ts') %}
{% set extensionItems = extension_menu_items('customer') %}
{% set marketplaceItems = extensionItems is not empty ? extensionItems : [{ label: 'Erweiterungen', href: '/customer/extensions' }] %}

{% set sidebarGroups = [
    {
        label: 'Übersicht',
        open: true,
        items: [
            { key: 'dashboard', label: 'Dashboard', href: '/dashboard' },
            { key: 'activity', label: 'Aktivität', href: '/activity' }
        ]
    },
    {
        label: 'Infrastruktur',
        open: true,
        items: [
            { key: 'gameservers', label: 'Game-Server', href: '/kunden/servers' },
            showVoiceserver ? { key: 'voiceservers', label: 'Voiceserver/TeamSpeak', href: voiceserverUrl } : null,
            { key: 'sinusbot', label: 'SinusBot', href: '/customer/infrastructure/sinusbot' }
        ]|filter(v => v)
    },
    {
        label: 'Services',
        open: true,
        items: [
            { key: 'webspaces', label: 'Webspace', href: '/files' },
            { key: 'databases', label: 'Datenbanken', href: '/databases' }
        ]
    },
    {
        label: 'Domains & E-Mail',
        open: true,
        items: [
            { key: 'domains', label: 'Domains', href: '/domains' },
            { key: 'mail', label: 'E-Mail', href: '/mail' }
        ]
    },
    {
        label: 'Support',
        open: true,
        items: [
            { key: 'tickets', label: 'Tickets', href: '/tickets' }
        ]
    },
    {
        label: 'Marketplace',
        open: true,
        items: marketplaceItems
    }
] %}

<div class="ng-layout">
    {% include 'components/_sidebar.html.twig' with {
        title: 'Easy-Wi NextGen',
        activeNav: activeNav,
        groups: sidebarGroups,
        footer: t('customer_portal_tagline', page_locale())
    } %}

    <main class="ng-main">
        {% include 'components/_topbar.html.twig' with {
            title: pageTitle|default(''),
            subtitle: pageSubtitle|default(''),
            actions: topbarActions|default([])
        } %}
        <div class="ng-content">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>
<script>
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
    }

    document.addEventListener('click', (event) => {
        const button = event.target.closest('[data-copy-value]');
        if (!button) {
            return;
        }

        const value = button.dataset.copyValue;
        if (!value) {
            return;
        }

        const originalText = button.dataset.copyOriginal ?? button.textContent?.trim() ?? '';
        button.dataset.copyOriginal = originalText;

        navigator.clipboard.writeText(value).then(() => {
            button.textContent = '{{ t('customer_copy_success', page_locale()) }}';
            window.setTimeout(() => {
                button.textContent = originalText;
            }, 1200);
        });
    });
</script>
</body>
</html>
