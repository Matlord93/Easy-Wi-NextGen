<!DOCTYPE html>
{% set siteTitle = app_setting('site_title', 'Easy-Wi NextGen') %}
{% set brandingName = app_setting('branding_name', siteTitle) %}
{% set brandingLogo = app_setting('branding_logo_url') %}
<html lang="{{ pageLocale|default(page_locale()) }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        (function () {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    {% block title %}{{ siteTitle }}{% endblock %}
    <title>{{ block('title')|replace({'Easy-Wi NextGen': siteTitle}) }}</title>
    <link rel="stylesheet" href="{{ asset('ui.css') }}">
    <link rel="stylesheet" href="{{ asset('admin-customer.css') }}">
    <link rel="stylesheet" href="{{ asset('ts6.css') }}">
    <link rel="stylesheet" href="{{ asset('ts3.css') }}">
    <script src="{{ asset('htmx.min.js') }}"></script>
</head>
<body class="customer-interface ng-shell">
{% set activeNav = activeNav|default('') %}
{% set voiceserverUrl = module_enabled('ts6')
    ? path('customer_ts6_servers_index')
    : path('customer_ts3_servers_index')
%}
{% set showVoiceserver = module_enabled('ts6') or module_enabled('ts') %}
{% set extensionItems = extension_menu_items('customer') %}
{% set marketplaceItems = extensionItems is not empty ? extensionItems : [] %}

{% set sidebarGroups = [
    {
        label: 'Übersicht',
        open: true,
        items: [
            { key: 'dashboard', label: 'Dashboard', href: path('customer_dashboard') },
            { key: 'activity', label: 'Aktivität', href: path('customer_activity') }
        ]
    },
    {
        label: 'Infrastruktur',
        open: true,
        items: [
            { key: 'gameservers', label: 'Game-Server', href: path('customer_instances') },
            showVoiceserver ? { key: 'voiceservers', label: 'Voiceserver/TeamSpeak', href: voiceserverUrl } : null,
            { key: 'sinusbot', label: 'SinusBot', href: path('customer_sinusbot_index') }
        ]|filter(v => v)
    },
    {
        label: 'Services',
        open: true,
        items: [
            { key: 'webspaces', label: 'Webspace', href: path('customer_webspace') },
            { key: 'databases', label: 'Datenbanken', href: path('customer_databases') }
        ]
    },
    {
        label: 'Domains & E-Mail',
        open: true,
        items: [
            { key: 'domains', label: 'Domains', href: path('customer_domains') },
            { key: 'mail', label: 'E-Mail', href: path('customer_mail') }
        ]
    },
    {
        label: 'Support',
        open: true,
        items: [
            { key: 'tickets', label: 'Tickets', href: path('customer_tickets') }
        ]
    },
    {
        label: 'Marketplace',
        open: true,
        items: ([{ key: 'shop', label: 'Shop', href: path('customer_shop') }]|merge(marketplaceItems))
    }
] %}

<div class="ng-layout">
    {% include 'components/_sidebar.html.twig' with {
        title: '',
        logoUrl: null,
        activeNav: activeNav,
        groups: sidebarGroups,
        footer: ''
    } %}

    <main class="ng-main">
        {% include 'components/_topbar.html.twig' with {
            title: pageTitle|default(''),
            subtitle: pageSubtitle|default(''),
            actions: topbarActions|default([])
        } %}
        <div class="ng-content">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>
<script>
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
    }

    document.addEventListener('click', (event) => {
        const button = event.target.closest('[data-copy-value]');
        if (!button) {
            return;
        }

        const value = button.dataset.copyValue;
        if (!value) {
            return;
        }

        const originalText = button.dataset.copyOriginal ?? button.textContent?.trim() ?? '';
        button.dataset.copyOriginal = originalText;

        navigator.clipboard.writeText(value).then(() => {
            button.textContent = '{{ t('customer_copy_success', page_locale()) }}';
            window.setTimeout(() => {
                button.textContent = originalText;
            }, 1200);
        });
    });
</script>
</body>
</html>
