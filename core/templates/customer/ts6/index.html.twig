{% extends 'customer/base.html.twig' %}


{% block content %}
    <div class="space-y-10">
        <div>
            <div class="flex flex-wrap items-center gap-3">
                <h1 class="text-2xl font-semibold text-slate-900">{{ t('customer_ts6_heading', page_locale()) }}</h1>
                <span class="inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700">{{ t('customer_ts6_badge_planned', page_locale()) }}</span>
                <span class="inline-flex items-center rounded-full bg-purple-100 px-3 py-1 text-xs font-semibold text-purple-700">{{ t('customer_ts6_badge_experimental', page_locale()) }}</span>
            </div>
            <p class="mt-2 text-sm text-slate-700">{{ t('customer_ts6_intro', page_locale()) }}</p>
            {% if notice %}
                <div class="mt-4 rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">{{ t(notice, page_locale()) }}</div>
            {% endif %}
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white">
            <div class="border-b border-slate-200 px-6 py-4">
                <h2 class="text-lg font-semibold text-slate-900">{{ t('customer_ts6_instances_title', page_locale()) }}</h2>
                <p class="mt-1 text-sm text-slate-700">{{ t('customer_ts6_instances_intro', page_locale()) }}</p>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full text-left text-sm">
                    <thead class="bg-slate-50 text-xs font-semibold uppercase text-slate-600">
                        <tr>
                            <th class="px-6 py-3">{{ t('customer_ts6_table_instance', page_locale()) }}</th>
                            <th class="px-6 py-3">{{ t('customer_ts6_table_node', page_locale()) }}</th>
                            <th class="px-6 py-3">{{ t('customer_ts6_table_status', page_locale()) }}</th>
                            <th class="px-6 py-3">{{ t('customer_ts6_table_updated', page_locale()) }}</th>
                            <th class="px-6 py-3">{{ t('customer_ts6_table_actions', page_locale()) }}</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {% if instances is not empty %}
                            {% set statusClasses = {
                                planned: 'bg-amber-100 text-amber-700',
                                provisioning: 'bg-sky-100 text-sky-700',
                                running: 'bg-emerald-100 text-emerald-700',
                                stopped: 'bg-slate-100 text-slate-600',
                                error: 'bg-rose-100 text-rose-700'
                            } %}
                            {% for instance in instances %}
                                <tr>
                                    <td class="px-6 py-4 font-medium text-slate-900">{{ instance.name }}</td>
                                    <td class="px-6 py-4 text-slate-600">{{ instance.node }}</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold {{ statusClasses[instance.status] ?? 'bg-slate-100 text-slate-600' }}">
                                            {{ t('customer_ts6_status_' ~ instance.status, page_locale()) }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-slate-600">{{ instance.updated_at|date('Y-m-d H:i') }}</td>
                                    <td class="px-6 py-4">
                                        <div class="flex flex-wrap gap-2">
                                            <form method="post" action="/ts6/{{ instance.id }}/action">
                                                <input type="hidden" name="action" value="start">
                                                <button class="rounded-lg border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50">{{ t('customer_ts6_action_start', page_locale()) }}</button>
                                            </form>
                                            <form method="post" action="/ts6/{{ instance.id }}/action">
                                                <input type="hidden" name="action" value="stop">
                                                <button class="rounded-lg border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50">{{ t('customer_ts6_action_stop', page_locale()) }}</button>
                                            </form>
                                            <form method="post" action="/ts6/{{ instance.id }}/action">
                                                <input type="hidden" name="action" value="restart">
                                                <button class="rounded-lg border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50">{{ t('customer_ts6_action_restart', page_locale()) }}</button>
                                            </form>
                                            <form method="post" action="/ts6/{{ instance.id }}/action">
                                                <input type="hidden" name="action" value="update">
                                                <button class="rounded-lg border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50">{{ t('customer_ts6_action_update', page_locale()) }}</button>
                                            </form>
                                        </div>
                                        <div class="mt-3 flex flex-wrap items-center gap-2">
                                            <form method="post" action="/ts6/{{ instance.id }}/action" class="flex flex-wrap items-center gap-2">
                                                <input type="hidden" name="action" value="backup">
                                                <input name="backup_path" class="w-44 rounded-lg border border-slate-200 px-2 py-1 text-xs" placeholder="{{ t('customer_ts6_backup_placeholder', page_locale()) }}">
                                                <button class="rounded-lg border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50">{{ t('customer_ts6_action_backup', page_locale()) }}</button>
                                            </form>
                                            <form method="post" action="/ts6/{{ instance.id }}/action" class="flex flex-wrap items-center gap-2">
                                                <input type="hidden" name="action" value="restore">
                                                <input name="restore_path" class="w-44 rounded-lg border border-slate-200 px-2 py-1 text-xs" placeholder="{{ t('customer_ts6_restore_placeholder', page_locale()) }}">
                                                <button class="rounded-lg border border-slate-200 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50">{{ t('customer_ts6_action_restore', page_locale()) }}</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td class="px-6 py-6 text-center text-sm text-slate-600" colspan="5">
                                    {{ t('customer_ts6_instances_empty', page_locale()) }}
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white">
            <div class="border-b border-slate-200 px-6 py-4">
                <h2 class="text-lg font-semibold text-slate-900">{{ t('customer_ts6_virtual_title', page_locale()) }}</h2>
                <p class="mt-1 text-sm text-slate-700">{{ t('customer_ts6_virtual_intro', page_locale()) }}</p>
            </div>
            {% if virtual_servers_enabled %}
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left text-sm">
                        <thead class="bg-slate-50 text-xs font-semibold uppercase text-slate-600">
                            <tr>
                                <th class="px-6 py-3">{{ t('customer_ts6_table_virtual_server', page_locale()) }}</th>
                                <th class="px-6 py-3">{{ t('customer_ts6_table_virtual_instance', page_locale()) }}</th>
                                <th class="px-6 py-3">{{ t('customer_ts6_table_virtual_slots', page_locale()) }}</th>
                                <th class="px-6 py-3">{{ t('customer_ts6_table_status', page_locale()) }}</th>
                                <th class="px-6 py-3">{{ t('customer_ts6_table_updated', page_locale()) }}</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            {% if virtual_servers is not empty %}
                                {% set virtualStatusClasses = {
                                    planned: 'bg-amber-100 text-amber-700',
                                    active: 'bg-emerald-100 text-emerald-700',
                                    stopped: 'bg-slate-100 text-slate-600',
                                    error: 'bg-rose-100 text-rose-700'
                                } %}
                                {% for server in virtual_servers %}
                                    <tr>
                                        <td class="px-6 py-4 font-medium text-slate-900">{{ server.name }}</td>
                                        <td class="px-6 py-4 text-slate-600">{{ server.instance }}</td>
                                        <td class="px-6 py-4 text-slate-600">{{ server.slots }}</td>
                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold {{ virtualStatusClasses[server.status] ?? 'bg-slate-100 text-slate-600' }}">
                                                {{ t('customer_ts6_status_' ~ server.status, page_locale()) }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 text-slate-600">{{ server.updated_at|date('Y-m-d H:i') }}</td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td class="px-6 py-6 text-center text-sm text-slate-600" colspan="5">
                                        {{ t('customer_ts6_virtual_empty', page_locale()) }}
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="px-6 py-6 text-sm text-slate-600">
                    {{ t('customer_ts6_virtual_disabled', page_locale()) }}
                </div>
            {% endif %}
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white">
            <div class="border-b border-slate-200 px-6 py-4">
                <h2 class="text-lg font-semibold text-slate-900">{{ t('customer_ts6_commands_title', page_locale()) }}</h2>
                <p class="mt-1 text-sm text-slate-700">{{ t('customer_ts6_commands_intro', page_locale()) }}</p>
            </div>
            <div class="divide-y divide-slate-100">
                {% if commands is not empty %}
                    {% for command in commands %}
                        <details class="group px-6 py-4">
                            <summary class="flex cursor-pointer items-center justify-between text-sm font-semibold text-slate-900">
                                <span>{{ command.command }}</span>
                                <svg class="h-4 w-4 text-slate-400 transition group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 11.17l3.71-3.94a.75.75 0 1 1 1.08 1.04l-4.25 4.5a.75.75 0 0 1-1.08 0l-4.25-4.5a.75.75 0 0 1 .02-1.06Z"/>
                                </svg>
                            </summary>
                            <div class="mt-3 space-y-2 text-sm text-slate-700">
                                {% if command.description %}
                                    <p>{{ command.description }}</p>
                                {% endif %}
                                {% if command.usage %}
                                    <div class="rounded-lg bg-slate-50 px-3 py-2 font-mono text-xs text-slate-700">{{ command.usage }}</div>
                                {% endif %}
                            </div>
                        </details>
                    {% endfor %}
                {% else %}
                    <div class="px-6 py-6 text-sm text-slate-600">{{ t('customer_ts6_commands_empty', page_locale()) }}</div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
