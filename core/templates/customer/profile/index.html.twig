{% extends 'customer/base.html.twig' %}

{% block title %}Profile & Billing Â· Easy-Wi NextGen{% endblock %}

{% block content %}
<div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between mb-6">
    <div>
        <h1 class="text-2xl font-semibold">Profile &amp; Billing</h1>
        <p class="text-sm text-slate-500">Manage your contact details, invoice address, and delivery preferences.</p>
    </div>
    <div class="flex items-center gap-3">
        <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700">
            Invoice ready
        </span>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="rounded-xl bg-white border border-slate-200">
        <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200">
            <div>
                <h2 class="text-lg font-semibold">Customer Profile</h2>
                <p class="text-sm text-slate-500">Use the address below for invoices and contracts.</p>
            </div>
            <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">Required</span>
        </div>
        <form method="post" action="/profile/customer" class="px-5 py-5 space-y-4">
            {% if profile.success %}
                <div class="rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
                    Profile saved successfully.
                </div>
            {% endif %}
            {% if profile.errors %}
                <div class="rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
                    <p class="font-semibold">Please fix the following:</p>
                    <ul class="mt-2 list-disc space-y-1 pl-5">
                        {% for error in profile.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="text-xs font-semibold uppercase text-slate-500">First name</label>
                    <input name="firstname" value="{{ profile.firstname }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                </div>
                <div>
                    <label class="text-xs font-semibold uppercase text-slate-500">Last name</label>
                    <input name="lastname" value="{{ profile.lastname }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                </div>
            </div>

            <div>
                <label class="text-xs font-semibold uppercase text-slate-500">Street address</label>
                <input name="address" value="{{ profile.address }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                    <label class="text-xs font-semibold uppercase text-slate-500">Postal code</label>
                    <input name="postal" value="{{ profile.postal }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                </div>
                <div class="sm:col-span-2">
                    <label class="text-xs font-semibold uppercase text-slate-500">City</label>
                    <input name="city" value="{{ profile.city }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                </div>
            </div>

            <div>
                <label class="text-xs font-semibold uppercase text-slate-500">Country</label>
                <select name="country" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                    {% for code, label in countries %}
                        <option value="{{ code }}" {{ profile.country == code ? 'selected' : '' }}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="text-xs font-semibold uppercase text-slate-500">Phone (optional)</label>
                    <input name="phone" value="{{ profile.phone }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200">
                </div>
                <div>
                    <label class="text-xs font-semibold uppercase text-slate-500">Company (optional)</label>
                    <input name="company" value="{{ profile.company }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200">
                </div>
            </div>

            <div>
                <label class="text-xs font-semibold uppercase text-slate-500">VAT ID (optional)</label>
                <input name="vat_id" value="{{ profile.vat_id }}" class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200">
                <p class="mt-2 text-xs text-slate-500">Use your full VAT ID including the country code (e.g. DE123456789).</p>
            </div>

            <div class="flex justify-end">
                <button class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white">Save profile</button>
            </div>
        </form>
    </div>

    <div class="rounded-xl bg-white border border-slate-200">
        <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200">
            <div>
                <h2 class="text-lg font-semibold">Invoice Preferences</h2>
                <p class="text-sm text-slate-500">Choose delivery channels and your default payment option.</p>
            </div>
            <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">Preferences</span>
        </div>
        <form method="post" action="/profile/invoice" class="px-5 py-5 space-y-4">
            {% if preferences.success %}
                <div class="rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
                    Preferences updated.
                </div>
            {% endif %}
            {% if preferences.errors %}
                <div class="rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
                    <p class="font-semibold">Please fix the following:</p>
                    <ul class="mt-2 list-disc space-y-1 pl-5">
                        {% for error in preferences.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <div>
                <label class="text-xs font-semibold uppercase text-slate-500">Portal language</label>
                <select name="portal_language" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                    {% for code, label in portalLanguages %}
                        <option value="{{ code }}" {{ preferences.portal_language == code ? 'selected' : '' }}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label class="text-xs font-semibold uppercase text-slate-500">Invoice locale</label>
                <select name="locale" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                    {% for code, label in locales %}
                        <option value="{{ code }}" {{ preferences.locale == code ? 'selected' : '' }}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 space-y-3">
                <label class="flex items-center gap-3 text-sm text-slate-700">
                    <input type="checkbox" name="email_delivery" value="1" class="h-4 w-4 rounded border-slate-300" {{ preferences.email_delivery ? 'checked' : '' }}>
                    Email me invoices when they are issued.
                </label>
                <label class="flex items-center gap-3 text-sm text-slate-700">
                    <input type="checkbox" name="pdf_download_history" value="1" class="h-4 w-4 rounded border-slate-300" {{ preferences.pdf_download_history ? 'checked' : '' }}>
                    Keep PDFs available in my download history.
                </label>
            </div>

            <div>
                <label class="text-xs font-semibold uppercase text-slate-500">Default payment method</label>
                <select name="payment_method" class="mt-1 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200" required>
                    {% for code, label in paymentMethods %}
                        <option value="{{ code }}" {{ preferences.payment_method == code ? 'selected' : '' }}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="flex justify-end">
                <button class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white">Save preferences</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
