{% set title = title|default('') %}
{% set groups = groups|default([]) %}
{% set activeNav = activeNav|default('') %}
{% set logoUrl = logoUrl|default(null) %}

<aside class="ng-sidebar">
    {% if logoUrl or title %}
        <div class="ng-sidebar__title">
            {% if logoUrl %}
                <img src="{{ logoUrl }}" alt="{{ title }}" style="max-height: 32px; width: auto;" />
            {% endif %}
            {% if title %}
                <span>{{ title }}</span>
            {% endif %}
        </div>
    {% endif %}
    <nav class="ng-sidebar__nav">
        {% for group in groups %}
            {% set groupId = group.id|default(group.label|default(loop.index)) %}
            <details class="ng-sidebar__group" data-nav-id="{{ groupId|lower|replace({' ': '-'}) }}" {{ group.open ? 'open' : '' }}>
                <summary class="ng-sidebar__group-label">
                    <span>{{ group.label }}</span>
                    <span class="ng-sidebar__chevron"></span>
                </summary>
                <div class="ng-sidebar__items">
                    {% for item in group.items %}
                        {% set itemKey = item.key|default(item.href|default(item.label|default(''))) %}
                        {% set isActive = activeNav == itemKey %}
                        <a href="{{ item.href }}" class="ng-sidebar__item {{ isActive ? 'is-active' : '' }}">
                            {% if item.iconSvg is defined and item.iconSvg %}
                                <span class="ng-sidebar__icon">{{ item.iconSvg|raw }}</span>
                            {% elseif item.icon is defined and item.icon %}
                                <span class="ng-sidebar__icon">{{ item.icon|raw }}</span>
                            {% endif %}
                            <span class="ng-sidebar__text">{{ item.label }}</span>
                        </a>
                    {% endfor %}
                </div>
            </details>
        {% endfor %}
    </nav>
    {% if footer is defined and footer %}
        <div class="ng-sidebar__footer">{{ footer }}</div>
    {% endif %}
</aside>
<script>
    document.querySelectorAll('.ng-sidebar__group[data-nav-id]').forEach((group) => {
        const key = `ng-sidebar-group:${group.dataset.navId}`;
        const stored = localStorage.getItem(key);
        if (stored !== null) {
            group.open = stored === 'open';
        }
        group.addEventListener('toggle', () => {
            localStorage.setItem(key, group.open ? 'open' : 'closed');
        });
    });
</script>
